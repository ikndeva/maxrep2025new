%% prelim.tex
\section{Preliminaries}
\label{sec:prelim}
%% \rule{5mm}{10em}
%% \rule{5mm}{5em}

\subsection{Texts, substrings, prefixes, and suffixes}
%%%%
We assume the word RAM model with machine word size $w = \floor{\log n}$ with input size $n$~\cite{navarro2016cds:book}, where space is always measured in machine \textit{words}, not \textit{bits}. 
For any integers $i\le j$, we define intervals $[i]=\set{1,\dots,i}$ and $[i..j] = \set{i, i+1, \dots, j}$.

Let $\Sigma$ be an alphabet of $\sigma\ge 2$ characters. We denote by $\eps$ the \textit{empty string} of length $0$, and by $\Sigma^*$ the set of all strings of length $\ge 0$. 
Throughout this paper, as input, we always assume a fixed string $S[1..n] = S[1]\dots S[n] \in \Sigma^*$ of length $|S| = n$ over $\Sigma$, called a \textit{text}, where an index starts from $1$. The string is terminated by a special endmarker $S[n]=\daller$, which do not appear elsewhere in $S$, and are smaller than any other characters. $S\rev$ denotes the \textit{reverse} of $S$, i.e., $S\rev = S[n]\dots S[1]$. 
If $S = XYZ$ for some strings $X, Y, Z \in \Sigma^*$, we call $X, Y$, and $Z$ a \textit{prefix}, a \textit{substring} and a \textit{suffix} of $S$, respectively.
For $1\le p \le q\le n$, $S[p..q]$ denotes the substring of $S$ starting from position $p$ and ends at $q$. Then, $p$ and $q$ are called the \textit{start-position} and \textit{end-position} of $W$.
For any string $W \in \Sigma^*$, $\spos[S](W)$, $\epos[S](W)$, and $\occ[S](W) = |\spos[S](W)| = |\epos[S](W)|$  denote the set of all start-positions, the set of all end-positions, and the number of occurrences of $W$ in $S$, respectively.
In what follows, we will omit the subscript $S$ if it is clear from context.


%% %%%%%%
%% \input{fig/table1}
%% size: n=12
\begin{table}[t]
\caption{
  An example of the rank, suffix, inverse suffix, and Burrows-Wheeler Transformation (BWT), and longest common prefix arrays, and the set of lexicographically ordered suffixes of a text \texttt{abcadabcabc\daller} of length $n=13$, where $\# < \daller < a < b < c < d$ and the index starts from $0$. 
}\label{tbl:arrays}
%% \small 
\ttfamily
\renewcommand{\arraystretch}{.8}
\centering
\smallskip
\begin{tabular}{wc{2.5em}wc{2.5em}wc{2.5em}wc{2.5em}lcccc}
%% \hline
\toprule
rank	& SA	& BWT	& LCP		& suffix	\\
%% index from one 
%% \midrule
%% 1	& 1	& \$	& 0		& \#abcadabcabc\$	\\
%% 2	& 13	& c	& 0		& \$	\\
%% 3	& 10	& c	& 0		& abc\$	\\
%% 4	& 7	& d	& 3		& abcabc\$	\\
%% 5	& 2	& \#	& 4		& abcadabcabc\$	\\
%% 6	& 5	& c	& 1		& adabcabc\$	\\
%% 7	& 11	& a	& 0		& bc\$	\\
%% 8	& 8	& a	& 2		& bcabc\$	\\
%% 9	& 3	& a	& 3		& bcadabcabc\$	\\
%% 10	& 12	& b	& 0		& c\$	\\
%% 11	& 9	& b	& 1		& cabc\$	\\
%% 12	& 4	& b	& 2		& cadabcabc\$	\\
%% 13	& 6	& a	& 0		& dabcabc\$	\\
%% \bottomrule
%%
%% index from zero
\midrule
0	& 0	& \$	& 0		& \#abcadabcabc\$	\\
1	& 12	& c	& 0		& \$	\\
2	& 9	& c	& 0		& abc\$	\\
3	& 6	& d	& 3		& abcabc\$	\\
4	& 1	& \#	& 4		& abcadabcabc\$	\\
5	& 4	& c	& 1		& adabcabc\$	\\
6	& 10	& a	& 0		& bc\$	\\
7	& 7	& a	& 2		& bcabc\$	\\
8	& 2	& a	& 3		& bcadabcabc\$	\\
9	& 11	& b	& 0		& c\$	\\
10	& 8	& b	& 1		& cabc\$	\\
11	& 3	& b	& 2		& cadabcabc\$	\\
12	& 5	& a	& 0		& dabcabc\$	\\
\bottomrule
\end{tabular}
\end{table}
%%%%%%%%%%


\subsection{Array-like text indexing data structures}
\label{sec:prelim:ds:array}
%%%%%%%%%%5
Let $S = S[1..n] \in \Sigma^n$ be a string of length $n$ (denoted \textsc{Txt}) throughout.
We refer to lexicographic ranks as $i, k$ and positions as $p, q$.
We assume that the reader is familier with fundamental text indexing data structures such as the suffix tree. Below, we introduce basic text indexing array structures.  (See text books, e.g., Gusfield~\cite{gusfield1997book:stree} and Crochemore and Rytter~\cite{crochemore2002jewels} for the suffix tree and the CDAWG, and Navarro~\cite{navarro2016cds:book} for compact array-like text indexing data structures.) 

The \textit{suffix array}~\cite{manber:myers1993suffixarrays} of a string $S \in \Sigma^n$ is an array $SA[1..n] \in [n]^n$ such that all suffixes of $S$ are ordered as
$S_{SA[1]}<_\lex S_{SA[2]}<_\lex \dots <_\lex S_{SA[n]}$
in the lexicographic order $<_\lex$, where $S_{p} := S[p..n]$. Each $k \in [n]$ is called the (lexicographic) \textit{rank} of the suffix $S[SA[k], n]$ in $SA$. 
The \textit{inverse suffix array}~\cite{manber:myers1993suffixarrays} is an array $ISA[1..n] \in [n]^n$ defined such that $SA[ISA[p]] = p$ for all $p \in [n]$.

%%%
The \textit{Burrows-Wheeler Transformation (BWT)}~\cite{burrows:wheeler1994blocksorting} is an array $BWT[1..n] \in \Sigma^n$ defining the permutation of a string $S$ such that $BWT[k] = \daller$ if $SA[k] = 1$ and $BWT[k] = S[SA[k]-1]$ otherwise for all $k \in [n]$. 
%% For any $k \in [n]$, the \textit{LF-mapping} is defined by $LF(k) = ISA[n]$ if $SA[k]=1$ and $LF(k) = ISA[SA[k]-1]$ otherwise.
%%
The \textit{Wavelet Tree} (WT) on BWT~\cite{grossi2003high} returns answers to the rank query and the \textit{range distinct query} (RD) on the BWT in $O(\log\sigma)$ query time in $O(n/\log_\sigma n)$ space~\cite{grossi2003high}. 

%% 
For any strings $s, t$, we denote by $lcp(s, t)$ the length of the longest common prefix of $s$ and $t$. The \textit{longest common prefix (LCP) array}~\cite{manber:myers1993suffixarrays,kasai:lee2001lcp:linear} is an array $LCP[1..n] \in [n]^n$ such that $LCP[1] = 0$ and
$LCP[k] = lcp(S_{SA[k-1]}, S_{SA[k]})$
%% $LCP[k] = lcp(S[SA[k-1],n], S[SA[k],n])$
for all $k \in [n]$.
For $1\le L\le R\le n$, the \textit{range minima query} (RMQ) on $LCP$, denoted $RMQ_{LCP}(L+1, R)$ asks the minimum $\ell$ of the lcp values between suffixes in $[L..R]$, i.e., $\ell = \min \set{ LCP[k] \mid L+1\le k\le R}$. There is a simple $O(n)$-space structure that supports RMQ in $O(1)$ time~\cite{bender:colton2000thelcaproblem}. 
Note that the RMQ is related to the \textit{LCE query}~\cite{navarro2016cds:book}
%% the \textit{longest common extension} (LCE) query
by $LCE(p, q) = RMQ_{LCP}(ISA[p]+1, ISA[q])$. 

%%For any positions $p_1, p_2 \in [n]$ in $S$, we denote the \textit{LCE query} by $\LCE(p_1, p_2) = lcp(S[p_1..n], S[p_2..n])$. 
%For any ranks $k_1, k_2$, the LCE query can be answered using the LCP array with the range minima structure by $\LCE(SA[k_1], SA[k_2]) = \op{RMQ}_{LCP}(k_1+1, k_2) = \min\set{LCP[k] \mid k \in [k_1+1, k_2] }$.

In \cref{tbl:arrays}, we show an example of the above indexing array strucrures for the same string \texttt{abcadabcabc\daller} in the previous example.
%%% 
All arrays above can be constructed in $O(n)$ time from a string $S[1..n]$ (See, e.g.,~\cite{navarro2016cds:book}). For space complexity, integer arrays $SA, ISA$, and $LCP$, occupy $n$ words, while character arrays $S$ and $BWT$ occupy $n/\log_\sigma n$ words on a word RAM. 
%%%



%%%%% 
\subsection{A concise representation of a substring}
\label{sec:triple}
We introduce a concise representation of a substring $W$ of a string $S$ with constant size, called the \textit{rich representation}, or simply a \textit{triple}, as follows~\cite{kasai:lee2001lcp:linear,ohlebusch2013bookbioinfo,belazzougui2015space:unusual}. 
Suppose that $SA \in [n]^n$ is the suffix array of $S$. Let $W \in Substr(S)$ be any substring of $S$. We can easily see that all ranks $k\in [1..n]$ whose starting positions $SA[k]$ belong to $\spos(W)$ occupy the contiguous subinterval $[L..R]\subseteq [1..n]$. We call this range $[L..R]$ the \textit{SA-range} of $W$.
We define the \textit{triple} for $W$ to be the integer triple $\tau = (L, R, \ell) \in [n]^3$, denoted $([L..R], \ell)$, such that $[L..R]$ is the SA-range of $W$ and $\ell = |W|$ is the length of $W$.
Conversely, $\tau$ \textit{defines} $W$ if $W = S[p..p+\ell-1]$ with $p = SA[L]$ is well-defined for some $k \in [L..R]$, and is unique. 
%%% 
For example, in \cref{tbl:arrays}, the substring $\mathtt{bc}$ has the triple $([7..9], 2)$ since it has the SA-range $[7,9]$ in $SA[1..13]$ and has the length $|W|=2$.


%%%% 
\subsection{Maximal repeats}
Now, we define the class of maximal repeats. 
%%are one of the most fundamental features in a string. 
Any subword $W$ of $S$ is called a \textit{repeat} if it occurs at least twice in $S$, namely, $\occ(W) \ge 2$.
A repeat $W$ is said to be \textit{left-branching} (resp.~\textit{right-branching}) in $S$ if either 
(i) $W$ is a prefix  of $S$ (resp.~a suffix of $S$), or 
(ii) there exist a pair of distict characters $a\not= b$ in $\Sigma$ such that $\occ(aW) \ge 1$ and $\occ(bW) \ge 1$ (resp.~$\occ(Wa) \ge 1$ and $\occ(Wb) \ge 1$).
A \textit{maximal repeat} is any repeat $W$ in $S$ that is both right-branching and left-branching in $S$. In what follows, $MR(S)$ denotes the set of all maximal repeats in $S$, and $\mu(S) = |MR(S)|$ denotes their number. 

A \textit{left-extension} (resp.~a \textit{right-extension}) of a maximal repeat $W \in MR(S)$ is any substring of $S$ in the form $cW$ (resp.~$Wc$) such that $\occ(cW)\ge 1$ for some $c \in \Sigma$. We denote by $e_L(S)$ (resp.~$e_R(S)$) the number of the left-extensions (resp.~right-extensions) in $S$. 
For a substring $W$ of $S$, $[W]^S_L = \sete{ U \in Substr(S) \mid \spos(U) = \spos(W) }$ denotes the equivalence class with the representative $W$, and $\rext W$ denotes the unique longest string in $[W]^S_L$. By symmetry, we can define the equivalence class $[W]^S_R$ and the representative $\lext W$  related to $\epos(W)$.
We often write, e.g., $e_L$ and $[W]_L$ for $e_L(S)$ and $[W]^S_L$, by omitting $S$. 

\begin{remark}
Weobserve the following properties: 
(i) for any repeat $W$, $\rext W$ is a right-branching repeat, while $\lext W$ is a left-branching repeat in $S$;
(ii) the operators $\set{\lext\cdot, \rext\cdot}$ are
%associative,
commutative and idenpotent.  
%the identities $\rext{(\lext W)} = \lext{(\rext W)} =: \mext W$,  $\lext{(\lext W)} = \lext W$, and  $\rext{(\rext W)} = \rext W$. 
(iii) a substring $U$ is a maximal repeat if and only if there exists a substring $W$ such that $U = \mext W := \rext{(\lext W)} = \lext{(\rext W)}$.
\end{remark}

Raffinot~\cite{raffinot2001maximal} found that the set $MR(S)$ coincides to the vertex set of the CDAWG~\cite{blumer1987complete} for a string $S$. 
Thus, $e_R$ satisfies $\mu \le e_R \le n$ and $\sigma \le e_R \le n$~\cite{blumer1987complete,raffinot2001maximal}. 
Belazzougui~\textit{et al.}~\cite{belazzougui:cunial:gagie:prezza:raffinot2015composite} have focused on $e_R$ as a fundamental repetitiveness measure related to $MR(S)$, and showed that $r \le e_R$ and $z \le e_R$. In general, $e_R = \Theta(n)$, while $e_R$ can be much smaller than $n$ for highly-repetitive strings. Radoszewski et al.~\cite{radoszewski:rytter2012structure:cdawg:thuemorse} showed that $e_R = O(\log n)$ for morphic strings, e.g.~Thue-Morse words.
